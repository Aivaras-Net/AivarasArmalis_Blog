@using Blog.Models

<div class="modal fade" id="blockCommentModal" tabindex="-1" aria-labelledby="blockCommentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="blockCommentModalLabel">Block Comment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-controller="CommentReports" asp-action="BlockComment" method="post" id="blockCommentForm">
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        <strong>Warning:</strong> Blocking a comment will hide it from regular users. This action should only be taken for comments that violate site rules.
                    </div>
                    
                    <p>You are blocking the following comment:</p>
                    <div class="comment-preview p-3 border rounded bg-light mb-3">
                        <div class="fw-bold comment-author-name"></div>
                        <div class="comment-text fst-italic"></div>
                    </div>
                    
                    <input type="hidden" name="commentId" id="blockCommentId" value="" />
                    
                    <div class="mb-3">
                        <label for="reason" class="form-label">Reason for blocking this comment:</label>
                        <textarea name="reason" id="blockReason" class="form-control" 
                                  rows="3" placeholder="Please provide a reason for blocking this comment..."
                                  minlength="10" maxlength="200" required></textarea>
                        <div class="form-text">This reason will be visible to administrators and moderators only.</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Block Comment</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        $('#blockCommentForm').on('submit', function(e) {
            e.preventDefault();
            
            var form = $(this);
            
            $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function(response) {
                    $('#blockCommentModal').modal('hide');
                    
                    form.trigger('reset');
                    
                    location.reload();
                },
                error: function(xhr, status, error) {
                    var errorMessage = 'An error occurred. Please try again.';
                    
                    if (xhr && xhr.responseJSON && xhr.responseJSON.message) {
                        errorMessage = xhr.responseJSON.message;
                    } else if (xhr && xhr.responseText) {
                        errorMessage = xhr.responseText;
                    } else if (error) {
                        errorMessage = error;
                    }
                    
                    var errorDiv = $('<div class="alert alert-danger"></div>').text(errorMessage);
                    form.find('.modal-body').prepend(errorDiv);
                    
                    setTimeout(function() {
                        errorDiv.fadeOut(function() {
                            $(this).remove();
                        });
                    }, 3000);
                }
            });
        });
        
        $(document).on('submit', '.unblock-form', function(e) {
            e.preventDefault();
            
            var form = $(this);
            var commentId = form.data('comment-id');
            
            $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function(response) {
                    location.reload();
                },
                error: function(xhr, status, error) {
                    console.error('Error unblocking comment:', error);
                    showNotification('Failed to unblock comment. Please try again.', 'danger');
                }
            });
        });
    });
</script> 