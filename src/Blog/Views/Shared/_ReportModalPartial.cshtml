@using Blog.Models

<div class="modal fade" id="reportCommentModal" tabindex="-1" aria-labelledby="reportCommentModalLabel"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reportCommentModalLabel">Report Comment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-controller="CommentReports" asp-action="Report" method="post" id="reportCommentForm">
                <div class="modal-body">
                    <p>You are reporting the following comment:</p>
                    <div class="comment-preview p-3 border rounded bg-light mb-3">
                        <div class="fw-bold comment-author-name"></div>
                        <div class="comment-text fst-italic"></div>
                    </div>

                    <input type="hidden" name="commentId" id="reportCommentId" value="" />

                    <div class="mb-3">
                        <label for="reason" class="form-label">Why are you reporting this comment?</label>
                        <select name="reason" id="reportReasonSelect" class="form-select mb-3" required>
                            <option value="">-- Select a reason --</option>
                            <option value="Contains inappropriate language">Contains inappropriate language</option>
                            <option value="Harassment or personal attack">Harassment or personal attack</option>
                            <option value="Spam or commercial content">Spam or commercial content</option>
                            <option value="Offensive content">Offensive content</option>
                            <option value="Misinformation">Misinformation</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="reportDetails" class="form-label">Please provide details:</label>
                        <textarea name="reportDetails" id="reportDetails" class="form-control" rows="4"
                            placeholder="Please provide any additional context or details that might help our moderators..."
                            maxlength="2000" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-warning">Report Comment</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        $('#reportCommentForm').on('submit', function (e) {
            e.preventDefault();

            var form = $(this);

            $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                },
                success: function (response) {
                    $('#reportCommentModal').modal('hide');

                    form.trigger('reset');

                    showNotification('Comment reported successfully. An administrator will review it.', 'success');
                },
                error: function (xhr, status, error) {
                    var errorMessage = 'An error occurred. Please try again.';

                    if (xhr && xhr.responseJSON && xhr.responseJSON.message) {
                        errorMessage = xhr.responseJSON.message;
                    } else if (xhr && xhr.responseText) {
                        errorMessage = xhr.responseText;
                    } else if (error) {
                        errorMessage = error;
                    }

                    var errorDiv = $('<div class="alert alert-danger"></div>').text(errorMessage);
                    form.find('.modal-body').prepend(errorDiv);

                    setTimeout(function () {
                        errorDiv.fadeOut(function () {
                            $(this).remove();
                        });
                    }, 3000);
                }
            });
        });
    });
</script>